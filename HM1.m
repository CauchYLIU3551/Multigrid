% -d(exp(x)du/dx)/dx=-exp(x)(cos(x)-2sin(x)-xcos(x)-xsin(x))
% 0<=x<=1
% u(0)=0; u(1)=cos(1);
% u(x)=xcos(x);

h=1/128;
a=0;
b=1;
n=(b-a)/h;

% build the stiff matrix;
A=sparse(n+1,n+1);
for j=1:n+1
  if j<=n
    A(j+1,j)=-1/h^2*(exp(j*h)-exp((j-1)*h));
  endif
  if j>=2
    A(j-1,j)=-1/h^2*(exp((j-1)*h)-exp((j-2)*h));
  endif
  if j<=n&&j>=2
    A(j,j)=1/h^2*(exp(j*h)-exp((j-1)*h))+1/h^2*(exp((j-1)*h)-exp((j-2)*h));
  endif
endfor
A(1,:)=0;
A(1,1)=1;
A(n+1,:)=0;
A(n+1,n+1)=1;

% build the tight hand side vector;
% maybe it is much better to use gauss-quadrature to compute the
% integral;
b=zeros(n+1,1);
t1=0.7745966692;
t2=0;
t3=-t1;
c1=5/9;
c2=8/9;
c3=5/9;
for i=2:n
  b(i)=h*(c1*-exp((h*t1+(i-1+i-2)*h)/2)* ...
  (cos((h*t1+(i-1+i-2)*h)/2)-2*sin((h*t1+(i-1+i-2)*h)/2) ...
  -(h*t1+(i-1+i-2)*h)/2*cos((h*t1+(i-1+i-2)*h)/2)- ...
  (h*t1+(i-1+i-2)*h)/2*sin((h*t1+(i-1+i-2)*h)/2)) ...
  *(t1-(i-2)*h)/h+ ...
  c2*-exp((h*t2+(i-1+i-2)*h)/2)* ...
  (cos((h*t2+(i-1+i-2)*h)/2)-2*sin((h*t2+(i-1+i-2)*h)/2) ...
  -(h*t2+(i-1+i-2)*h)/2*cos((h*t2+(i-1+i-2)*h)/2)- ...
  (h*t2+(i-1+i-2)*h)/2*sin((h*t2+(i-1+i-2)*h)/2)) ...
  *(t2-(i-2)*h)/h+ ...
  c3*-exp((h*t3+(i-1+i-2)*h)/2)* ...
  (cos((h*t3+(i-1+i-2)*h)/2)-2*sin((h*t3+(i-1+i-2)*h)/2) ...
  -(h*t3+(i-1+i-2)*h)/2*cos((h*t3+(i-1+i-2)*h)/2)- ...
  (h*t3+(i-1+i-2)*h)/2*sin((h*t3+(i-1+i-2)*h)/2)) ...
  *(t3-(i-2)*h)/h);
  
  % compute the right part integral...
  % here must be improved!!!!!
  b(i)=b(i)+h*(c1*-exp((h*t1+(i-1+i)*h)/2)* ...
  (cos((h*t1+(i-1+i)*h)/2)-2*sin((h*t1+(i-1+i)*h)/2) ...
  -(h*t1+(i-1+i)*h)/2*cos((h*t1+(i-1+i)*h)/2)- ...
  (h*t1+(i-1+i)*h)/2*sin((h*t1+(i-1+i)*h)/2)) ...
  *(i*h-t1)/h+ ...
  c2*-exp((h*t2+(i-1+i)*h)/2)* ...
  (cos((h*t2+(i-1+i)*h)/2)-2*sin((h*t2+(i-1+i)*h)/2) ...
  -(h*t2+(i-1+i)*h)/2*cos((h*t2+(i-1+i)*h)/2)- ...
  (h*t2+(i-1+i)*h)/2*sin((h*t2+(i-1+i)*h)/2)) ...
  *(i*h-t2)/h+ ...
  c3*-exp((h*t3+(i-1+i)*h)/2)* ...
  (cos((h*t3+(i-1+i)*h)/2)-2*sin((h*t3+(i-1+i)*h)/2) ...
  -(h*t3+(i-1+i)*h)/2*cos((h*t3+(i-1+i)*h)/2)- ...
  (h*t3+(i-1+i)*h)/2*sin((h*t3+(i-1+i)*h)/2)) ...
  *(i*h-t3)/h);
endfor
b(1)=0;
b(n+1)=cos(1);
u0=zeros(n+1,1);
%u=MG_2(A,b);
%x=0:h:1;
%plot(x, u,'b');
%hold on

plot(x, x.*cos(x),'r');
hold on 

u2=GS(A,u0,b,10000);
plot(x,u2,'g');

u3=A\b;
%plot(x,u3,'y');



